<ng-container *ngIf="settings">
  <ng-container *ngIf="data | filter: filterConfig | sort: sortConfig as rows">

    <!-- Pagination at the top -->
    <ng-container
      *ngIf="
        settings.pagination &&
        settings.pagination.visible &&
        (settings.pagination.position === paginationPosition.top ||
          settings.pagination.position === paginationPosition.both)
      "
    >
      <ng-container [ngTemplateOutlet]="customPagination"></ng-container>
    </ng-container>
    <!--/Pagination at the top -->

    <!-- Table -->
    <div class="ngx-vs-table-wrap">
      <table class="ngx-vs-table" [ngClass]="className">
        <ng-container *ngIf="settings.columns | responsive as keyList">
          <ng-container *ngIf="settings | heads: keyList : sortConfig as tableHead">
            <thead>
            <tr>
              <th
                *ngFor="let cell of tableHead.heads; trackBy: trackByKey"
                class="ngx-vs-table__head-cell"
                [class.sortable]="cell.sortable"
                [class.sticky]="cell.sticky"
                [class.sticky-column]="cell.stickyColumn"
              >
                <div (click)="onSort(cell)">
                  <ng-container *ngIf="cell.title && cell.title.component; else textTitle">
                    <ngx-vs-custom-cell
                      [component]="cell.title.component"
                      [init]="cell.title.componentOnInit"
                      [update]="cell.title.componentOnUpdate"
                      [destroy]="cell.title.componentOnDestroy"
                      [componentFactoryResolver]="cell.title.componentFactoryResolver"
                      [data]="data"
                    ></ngx-vs-custom-cell>
                  </ng-container>
                  <ng-template #textTitle>
                    <span>{{ cell.title }}</span
                    ><i
                    *ngIf="cell.sortable"
                    class="ngx-vs-table__sort"
                    [class.ngx-vs-table__sort-down]="cell.direction === sortDirection.desc"
                    [class.ngx-vs-table__sort-up]="cell.direction === sortDirection.asc"
                  ></i>
                  </ng-template>
                </div>
              </th>
            </tr>

            <tr *ngIf="tableHead.hasFilter">
              <th
                *ngFor="let filter of tableHead.filters; let i = index; trackBy: trackByKey"
                class="ngx-vs-table__head-cell"
              >
                <ng-container *ngIf="filter">
                  <ng-container [ngSwitch]="filter.type">
                    <div *ngSwitchCase="filterTypeControl.custom" class="ngx-vs-table__cell-filter">
                      <ngx-vs-custom-cell
                        [component]="filter.component"
                        [init]="filter.componentOnInit"
                        [update]="filter.componentOnUpdate"
                        [destroy]="filter.componentOnDestroy"
                        [componentFactoryResolver]="filter.componentFactoryResolver"
                        [data]="data"
                        [value]="{ filter: filter, index: i }"
                        [isFilter]="true"
                        (filterChange)="onUpdateFilter(filter, i, $event)"
                      ></ngx-vs-custom-cell>
                    </div>

                    <div *ngSwitchCase="filterTypeControl.checkbox" class="ngx-vs-table__cell-filter">
                      <input type="checkbox" (change)="onCheckBoxChange(filter, i, $event)"/>
                    </div>

                    <div *ngSwitchCase="filterTypeControl.select" class="ngx-vs-table__cell-filter">
                      <select (change)="onUpdateFilter(filter, i, $event.target.value)">
                        <option value="-1">{{ filter.placeholder }}</option>
                        <option *ngFor="let item of filter.list" [value]="item.value">{{ item.title }}</option>
                      </select>
                    </div>

                    <div *ngSwitchCase="filterTypeControl.number" class="ngx-vs-table__cell-filter">
                      <input
                        type="number"
                        [placeholder]="filter.placeholder"
                        (input)="onUpdateFilter(filter, i, $event.target.value)"
                      />
                    </div>

                    <div *ngSwitchDefault class="ngx-vs-table__cell-filter">
                      <input
                        type="text"
                        [placeholder]="filter.placeholder"
                        (input)="onUpdateFilter(filter, i, $event.target.value)"
                      />
                    </div>
                  </ng-container>
                </ng-container>
              </th>
            </tr>
            </thead>
          </ng-container>

          <ng-container *ngFor="let row of rows | pagination: settings.pagination:activePage:settings.mode; trackBy: identify">
            <tbody
              ngx-vs-row
              [row]="row"
              [columns]="settings.columns"
              [keysList]="keyList"
              [extendedBody]="extendedBody"
              [ngClass]="row | rowClass: settings.rowClassFunction"
            ></tbody>
          </ng-container>
        </ng-container>
      </table>
    </div>
    <!--/Table -->

    <!-- Pagination at the bottom -->
    <ng-container
      *ngIf="
        settings.pagination &&
        settings.pagination.visible &&
        (settings.pagination.position === paginationPosition.bottom ||
          settings.pagination.position === paginationPosition.both ||
          !settings.pagination.position)
      "
    >
      <ng-container [ngTemplateOutlet]="customPagination"></ng-container>
    </ng-container>
    <!--/Pagination at the bottom -->

    <!-- Pagination templates -->
    <ng-template #customPagination>
      <ng-container
        *ngIf="paginationTemplate; else defaultPagination"
        [ngTemplateOutlet]="paginationTemplate"
        [ngTemplateOutletContext]="{ active: activePage, count: rows.length, settings: settings.pagination }"
      ></ng-container>
    </ng-template>

    <ng-template #defaultPagination>
      <ngx-vs-pagination
        [settings]="settings.pagination"
        [count]="rows.length"
        [activePage]="activePage"
        (changed)="onPageChange($event)"
      ></ngx-vs-pagination>
    </ng-template>
    <!--/Pagination templates -->

  </ng-container>
</ng-container>
